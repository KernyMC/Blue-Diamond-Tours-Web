---
import { Icon } from "astro-icon/components";
import Button from "../common/Button.astro";
import ContactFormModal from "../common/ContactFormModal.astro";

const navLinks = [
    { name: "Inicio", path: "/" },
    { name: "Tours", path: "/tours" },
    { name: "Paquetes", path: "/paquetes" },
    { name: "Nosotros", path: "/nosotros" },
    { name: "Ferries", path: "/ferries" },
    { name: "Contacto", path: "/contacto" },
];

const currentPath = Astro.url.pathname;
const isActive = (path) =>
    currentPath === path || (path !== "/" && currentPath.startsWith(path));
---

<nav
    id="main-nav"
    class="fixed w-[95%] md:w-[85%] max-w-6xl top-6 left-1/2 -translate-x-1/2 z-50 bg-white/95 backdrop-blur-md shadow-2xl rounded-full flex justify-between items-center px-6 md:px-8 py-3 transition-all duration-500 ease-in-out border border-gray-100/50 scale-100"
>
    {/* Logo Section */}
    <a
        href="/"
        class="flex items-center gap-3 cursor-pointer no-underline group"
    >
        <div>
            <img
                src="/blue-diamond-logo-navbar.svg"
                alt="Blue Diamond Logo"
                width={64}
                height={24}
            />
        </div>
        <div>
            <div class="flex flex-col">
                <span
                    class="uppercase font-sans text-xl md:text-2xl font-bold text-[#0B3C6D] leading-none tracking-tight text-center"
                >
                    Galápagos
                </span>
                <span
                    class="uppercase font-sans text-[0.65rem] md:text-xs font-bold text-[#0B3C6D] tracking-[0.1em]"
                >
                    Bluediamond Tours
                </span>
            </div>
        </div>
    </a>

    {/* Desktop Menu */}
    <div class="hidden md:flex items-center gap-8">
        {
            navLinks.map((link) => (
                <a
                    href={link.path}
                    class={`text-sm font-bold tracking-wide transition-all duration-300 relative group no-underline
          ${isActive(link.path) ? "text-[#2EC4C6]" : "text-[#0B3C6D] hover:text-[#2EC4C6]"}
        `}
                >
                    {link.name}
                    <span
                        class={`absolute -bottom-1 left-0 h-0.5 bg-[#2EC4C6] transition-all duration-300 ${isActive(link.path) ? "w-full" : "w-0 group-hover:w-full"}`}
                    />
                </a>
            ))
        }
        <button
            onclick="openContactModal()"
            class="bg-[#2EC4C6] text-white py-2.5 px-6 rounded-full text-sm font-bold shadow-lg hover:shadow-[#2EC4C6]/30 hover:bg-[#1F5F99] transition-all cursor-pointer border-none"
        >
            Reserva Ya
        </button>
    </div>

    {/* Mobile Menu Button */}
    <button
        id="mobile-menu-btn"
        class="md:hidden text-[#0B3C6D] cursor-pointer"
    >
        <div id="menu-icon">
            <Icon name="ant-design:menu-outlined" />
        </div>
        <div id="close-icon" class="hidden">
            <Icon name="ant-design:close-outlined" />
        </div>
    </button>
</nav>

{/* Mobile Menu Overlay */}
<div
    id="mobile-menu"
    class="fixed inset-0 bg-white/95 backdrop-blur-xl z-40 transform translate-y-full transition-transform duration-500 md:hidden flex flex-col items-center justify-center gap-8"
>
    {
        navLinks.map((link) => (
            <a
                href={link.path}
                class={`text-2xl font-serif font-bold ${isActive(link.path) ? "text-[#2EC4C6]" : "text-[#0B3C6D]"} mobile-link`}
            >
                {link.name}
            </a>
        ))
    }
    <a href="/contacto" class="no-underline mt-4">
        <Button
            variant="primary"
            className="py-4 px-10 text-lg rounded-full shadow-xl"
        >
            Reserva Tu Aventura
        </Button>
    </a>
</div>

<script>
    // Navbar Scroll Effect (solo en móvil)
    const nav = document.getElementById("main-nav");

    if (nav) {
        window.addEventListener("scroll", () => {
            // Solo aplicar el efecto en pantallas menores a 768px (móviles)
            if (window.innerWidth < 768) {
                if (window.scrollY > 50) {
                    nav.classList.add("w-[92%]", "max-w-5xl", "scale-95");
                    nav.classList.remove("w-[95%]", "max-w-6xl", "scale-100");
                } else {
                    nav.classList.remove("w-[92%]", "max-w-5xl", "scale-95");
                    nav.classList.add("w-[95%]", "max-w-6xl", "scale-100");
                }
            }
        });
    }

    // Mobile Menu Toggle
    const menuBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuIcon = document.getElementById("menu-icon");
    const closeIcon = document.getElementById("close-icon");
    const mobileLinks = document.querySelectorAll(".mobile-link");
    let isMenuOpen = false;

    if (menuBtn && mobileMenu && menuIcon && closeIcon) {
        menuBtn.addEventListener("click", () => {
            isMenuOpen = !isMenuOpen;
            toggleMenu();
        });

        mobileLinks.forEach((link) => {
            link.addEventListener("click", () => {
                isMenuOpen = false;
                toggleMenu();
            });
        });

        function toggleMenu() {
            if (isMenuOpen) {
                mobileMenu.classList.remove("translate-y-full");
                menuIcon.classList.add("hidden");
                closeIcon.classList.remove("hidden");
                document.body.style.overflow = "hidden";
            } else {
                mobileMenu.classList.add("translate-y-full");
                menuIcon.classList.remove("hidden");
                closeIcon.classList.add("hidden");
                document.body.style.overflow = "";
            }
        }
    }
</script>

<!-- Contact Form Modal -->
<ContactFormModal />
